[.columns.is-vcentered]
== Contexte technique

[.column]
--
[link=https://en.m.wikipedia.org/wiki/File:Kubernetes_logo_without_workmark.svg]
image::kubernetes-logo.svg[width=100]
--

[.column]
--
[link=https://fr.wikipedia.org/wiki/VMware#/media/Fichier:Vmware-by-broadcom.svg]
image::vmware-logo.svg[width=100]
--

== !

[.column]
--
plantuml::diagrams/010-only-two-zones.puml[format=svg,id=010-only-two-zones]
--

[.notes]
****
On fait du Kube on prem, sur 2 régions.

Vous êtes en charge de mettre en place et maintenir un cluster Kubernetes. Il faut de la haute disponibilité. Vous n’avez que deux sites géographiques pour l’assurer.

Quoi ? Les recommandations parlent de __trois sites__ ?
Ça fait des années qu’on fait de la redondance avec deux sites, __au diable les recommandations !__ Ça va bien se passer.

A travers nos expériences, découvrons ensemble les problèmes rencontrés, les solutions envisagées et mises en œuvre, tant au niveau administration du cluster, qu'au niveau applicatif.
****

[%notitle]
== Définitions

image::definitions.jpg[]

[.notes]
****
Afin de s'assurer que l'on parle de la même chose durant cette présentation.
****

=== Haute Disponibilité

[.column]
--
[mermaid, target=haute-dispo, format=svg]   
....
---
config:
  layout: fixed
---
flowchart TD
 subgraph LB["Répartiteur"]
        vip("LB")
  end
 subgraph zoneA["zoneA"]
        n1("Node1")
  end
 subgraph zoneB["zoneB"]
        n2["Node2"]
  end
    zoneA x--x zoneB
    vip --> n1 & n2
     vip:::k8s
     n1:::k8s
     n2:::k8s
     zoneA:::cluster
     zoneB:::cluster
     LB:::cluster
    classDef plain fill:#ddd,stroke:#fff,stroke-width:4px,color:#000
    classDef k8s fill:#326ce5,stroke:#fff,stroke-width:4px,color:#fff
    classDef cluster fill:#fff,stroke:#bbb,stroke-width:2px,color:#326ce5
    linkStyle 0 stroke:#D50000,fill:none
....
--

[.notes]
****
HD = capacité à accéder à la plateforme au moment ou on le souhaite, redondance = panne sur un premier site pour permettre l'accès, notion de haute dispo, différentes stratégies (actif/passif avec sauvegarde ou miroir, TODO ajouter des schémas)
****

=== Redondance

=== Répartition de charge

[.notes]
****
Répartition charge - actif actif - autre schéma : partage de ressources (pool) sur les 2 sites. En cas de panne, le second peut récupérer charge du premier site et assurer service A
****

=== Stretched cluster

[.notes]
****
Un schéma vaut mille mots

Terminologie : pour les contextes dont nous allons parler, nous sommes partis sur une stratégie "stretched cluster". C'est-à-dire que nous avons un cluster k8s réparti sur deux sites en mode actif/actif.
****

[.column]
--
plantuml::diagrams/010-contexte.puml[format=svg,id=010-contexte]
--
